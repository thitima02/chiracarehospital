<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>โรงพยาบาลค่ายจิรประวัติ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@100..900&display=swap" rel="stylesheet">

    <style>
        body, button, input, select {
            font-family: Noto Sans Thai, sans-serif;
        }
    </style>
</head>

<body>

    <div class="container py-4">

        <div class="d-flex justify-content-between mb-4">
            <h1 class="h3 fw-bold mb-0">ระบบจัดการผู้ใช้</h1>
            <a class="btn btn-primary" href="user_register.html">เพิ่มผู้ใช้งาน</a>
        </div>

        <div class="table-responsive">
            <table class="table">
                <thead class="table-success">
                    <tr>
                        <th scope="col">ชื่อ-นามสกุล</th>
                        <th scope="col">ชื่อผู้ใช้</th>
                        <th scope="col">เขตที่รับผิดชอบ</th>
                        <th scope="col">เบอร์โทรศัพท์</th>
                        <th scope="col">สถานะ</th>
                        <th scope="col">จัดการ</th>
                    </tr>
                </thead>
                <tbody id="userTable">
                    <tr>
                        <th scope="row">1</th>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
            // เรียกข้อมูลจาก API เมื่อหน้าเว็บโหลดเสร็จ
            $.getJSON('/chiracarehospital/backend/sql/master/getUsers.php', function (response) {
                if (response.status === 'success') {
                    var staffs = response.data;
                    var rows = '';

                    // วนลูปข้อมูลผู้ใช้เพื่อแสดงในตาราง
                    staffs.forEach(function (staff) {
                        // ดึงข้อมูล user_info
                        rows += ` <tr>
                         <td>${staff.full_name}</td>
                         <td>${staff.username}</td>
                         <td>${staff.responsibility_area}</td>
                        <td>${staff.phone_number}</td>
						<td>${staff.department}</td>
                        <td>
                    <a class="btn btn-sm btn-outline-primary m-1" href="user_edit.html?id=${staff.id}">แก้ไข</a>
                    <button class="btn btn-sm btn-outline-danger m-1" onclick="confirmDelete(${staff.id})">ลบ</button>
                </td>
            </tr>`;


                    });

                    // แทรกข้อมูลในตาราง
                    $('#userTable').html(rows);
                } else {
                    alert(response.message);
                }
            });
        });

        function confirmDelete(userId) {
            if (confirm('คุณแน่ใจว่าต้องการลบข้อมูลนี้?')) {
                // ส่งคำขอลบไปยัง API
                $.ajax({
                    url: '/chiracarehospital/backend/sql/master/deleteUsers.php',
                    method: 'GET',
                    data: {
                        user_id: userId,
                    },
                    success: function (response) {
                        if (response.status === 'success') {
                            // รีโหลดหน้าเว็บหลังจากลบสำเร็จ
                            location.reload();
                        } else {
                            alert(response.message);
                        }
                    }
                });
            }
        }
    </script>
</body>

</html>