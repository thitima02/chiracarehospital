<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Information</title>
  <link rel="stylesheet" href="../../css/patient-info.css">
  <link rel="stylesheet" href="../../styles.css">
  <link rel="stylesheet" href="../../css/sidebar.css">
  <link rel="stylesheet" href="../../css/topbar.css">
  <link rel="stylesheet" href="../../css/logo.css">
  <script src="../method/logout.js"></script>
  <!-- Import icon -->
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<<<<<<< HEAD
=======
  <script src="../method/logout.js"></script>
    <!-- เชื่อมโยงไฟล์ JavaScript สำหรับจัดการการออกจากระบบ -->
    <script src="../method/user.js"></script>
    <!-- เชื่อมโยงไฟล์ JavaScript สำหรับการจัดการข้อมูลผู้ใช้ -->
    <script src="../method/loadSidebarScript.js"></script>
    <!-- เชื่อมโยงไฟล์ JavaScript สำหรับโหลดสคริปต์ sidebar -->
    <script src="../method/checkAuth.js"></script>
    <!-- เชื่อมโยงไฟล์ JavaScript สำหรับตรวจสอบการพิสูจน์ตัวตน (Authentication) -->

>>>>>>> 69a79a22d5b320bcd7829186ac66271859454842
</head>

<body style="background-color:#edeff1;">
  <!-- Sidebar will be loaded here -->
  <div id="sidebar-container"></div>

  <!-- Topbar will be loaded here -->
  <div id="topbar-container"></div>

  <div class="patientinfo-container">
    <div class="search-bar">
      <input type="search" placeholder="ค้นหาชื่อ" id="searchPatientInput" oninput="filterData()">
      <input type="search" placeholder="เบอร์โทรศัพท์" id="phoneFilter" oninput="filterData()">
      <input type="search" placeholder="เลขบัตรประชาชน" id="idCardFilter" oninput="filterData()">
      <input type="search" placeholder="เบอร์โทรศัพท์ญาติ..." id="relativePhoneFilter" oninput="filterData()">
      <select id="treatmentStatusFilter" onchange="filterData()">
        <option value="">สถานะผู้ป่วย</option>
        <option value="นัดติดตามต่อเนื่อง">นัดติดตามต่อเนื่อง</option>
        <option value="รักษาเสร็จสิ้น">รักษาเสร็จสิ้น</option>
      </select>
      <button class="add-icon">
        <a href="addinfo.html">
          <i class='bx bx-user-plus'></i>
        </a>
      </button>

      <button onclick="sortNames()">
        <i class='bx bx-filter'></i>
      </button>
    </div>

    <div class="table-container">
    <table class="patient-table">
      <thead>
        <tr>
          <th>ชื่อ - นามสกุล</th>
          <th>วันเกิด</th>
          <th>เลขบัตรประชาชน</th>
          <th>เบอร์โทรศัพท์</th>
          <th>เบอร์โทรศัพท์ญาติ</th>
          <th>สถานะปัจจุบัน</th>
          <th>จัดการ</th>
        </tr>
      </thead>
      <tbody id="patient-info-body">
        <!-- ข้อมูลผู้ป่วยจะแสดงตรงนี้ -->
      </tbody>
    </table>
  </div>
</div>

  <script>
    // ฟังก์ชันกรองข้อมูล
    function filterData() {
      const searchName = document.getElementById('searchPatientInput').value.toLowerCase();
      const phone = document.getElementById('phoneFilter').value;
      const idCard = document.getElementById('idCardFilter').value;
      const relativePhone = document.getElementById('relativePhoneFilter').value;

      const rows = document.querySelectorAll('#patient-info-body tr');

      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase(); // Assuming name is in the first cell
        const phoneValue = row.cells[3].textContent; // Assuming phone is in the fourth cell
        const idCardValue = row.cells[2].textContent; // Assuming ID card is in the third cell
        const relativePhoneValue = row.cells[4].textContent; // Assuming relative phone is in the fifth cell

        let isVisible = true;

        // Filter based on name
        if (searchName && !name.includes(searchName)) {
          isVisible = false;
        }
        // Filter based on phone
        if (phone && !phoneValue.includes(phone)) {  // Use includes for partial matches
          isVisible = false;
        }
        // Filter based on ID card
        if (idCard && idCardValue !== idCard) {
          isVisible = false;
        }
        // Filter based on relative phone
        if (relativePhone && !relativePhoneValue.includes(relativePhone)) { // Use includes for partial matches
          isVisible = false;
        }

        // Set the display property based on visibility
        row.style.display = isVisible ? '' : 'none'; // Show or hide the row based on visibility
      });
    }

    // เรียกใช้ filterData เมื่อโหลดหน้า
    document.addEventListener('DOMContentLoaded', function () {
      filterData();
    });

  </script>

<<<<<<< HEAD

  <script>
    // Load sidebar
    fetch('sidebar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('sidebar-container').innerHTML = data;
        loadSidebarScript(); // Initialize sidebar toggle after loading
      });

    // Load topbar and set the page title
    fetch('topbar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('topbar-container').innerHTML = data;
        document.getElementById('page-title').textContent = 'จัดการข้อมูลผู้ป่วย'; // Set page title for the history page
      });

    function loadSidebarScript() {
      let sidebar = document.querySelector(".sidebar");
      let closeBtn = document.querySelector("#btn");

      closeBtn.addEventListener("click", () => {
        sidebar.classList.toggle("open");
        menuBtnChange();
      });
      function menuBtnChange() {
        if (sidebar.classList.contains("open")) {
          closeBtn.classList.replace("bx-menu", "bx-menu-alt-right");
        } else {
          closeBtn.classList.replace("bx-menu-alt-right", "bx-menu");
        }
      }
    }
    document.getElementById('add-button').addEventListener('click', function () {
      window.location.href = 'editaddinfo.html';
    });
  </script>

=======
>>>>>>> 69a79a22d5b320bcd7829186ac66271859454842
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      // เรียกข้อมูลจาก API เมื่อหน้าเว็บโหลดเสร็จ
      $.getJSON('/chiracarehospital/backend/sql/patient_information/getAll_patient_information.php', function (response) {
        if (response.status === 'success') {
          var patients = response.data;
          var rows = '';

          // วนลูปข้อมูลผู้ป่วยเพื่อแสดงในตาราง
          patients.forEach(function (patient) {
            rows += '<tr>';
            rows += '<td><img src="../../assets/images/cat.jpg" alt="avatar"> ' + patient.full_name + '</td>';
            rows += '<td>' + formatDate(patient.birth_date) + '</td>';
            rows += '<td>' + patient.id_card + '</td>';
            rows += '<td>' + patient.phone_number + '</td>';
            rows += '<td>' + patient.emergency_phone + '</td>';
            rows += '<td class="status-label ' + getStatusColor(patient.current_status) + '">' + patient.current_status + '</td>';

            rows += '<td>';
            rows += '<button class="action-btn" title="แก้ไขข้อมูล" onclick="editPatient(\'' + patient.patient_id + '\')"><i class="bx bxs-edit"></i></button>';
            rows += '<button class="action-btn" title="ลบข้อมูล" onclick="deletePatient(\'' + patient.id + '\')"><i class="bx bx-trash"></i></button>';
            rows += '</td>';
            rows += '</tr>';
          });

          // แทรกข้อมูลในตาราง
          $('#patient-info-body').html(rows);
        } else {
          alert(response.message);
        }
      });

      // ฟังก์ชันสำหรับฟอร์แมตวันเกิด
      function formatDate(dateStr) {
        var date = new Date(dateStr);
        var day = String(date.getDate()).padStart(2, '0');
        var month = String(date.getMonth() + 1).padStart(2, '0'); // เดือนเริ่มจาก 0
        var year = date.getFullYear();
        return day + '-' + month + '-' + year;
      }


      function getStatusColor(status) {
        if (status === 'ปกติ (มีชีวิต,เป็นผู้ป่วยของรพบ)') {
          return 'green'; // สถานะสีเขียวสำหรับปกติ
        } else if (status === 'เสียชีวิต') {
          return 'red'; // สถานะสีแดงสำหรับเสียชีวิต
        } else if (status === 'ไม่เป็นผู้ป่วยแล้ว') {
          return 'blue'; // สีน้ำเงินสำหรับไม่เป็นผู้ป่วยแล้ว
        } else {
          return ''; // ค่าเริ่มต้น ถ้าไม่มีสถานะที่ตรงกัน
        }
      }

    });

    // ฟังก์ชันแก้ไขข้อมูลผู้ป่วย

    function editPatient(patient_id) {
      window.location.href = `editaddinfo.html?patient_id=${patient_id}`; // ส่ง patient_id ไปที่ URL
    }

    // ฟังก์ชันลบข้อมูลผู้ป่วย
    function deletePatient(patient_id) {
      if (confirm('คุณต้องการลบผู้ป่วย ID: ' + patient_id + ' ใช่หรือไม่?')) {
        // ใส่ logic การลบที่นี่
        alert('ลบข้อมูลผู้ป่วยเรียบร้อย');
      }
    }

  </script>

  <script>
    function getUserIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('patient_id');
    }

    function loadUserData() {
      const userId = getUserIdFromURL();
      if (userId) {
        fetch(`/chiracarehospital/backend/sql/patient_information/getAll_patient_information.php?id=${userId}`)
          .then(response => response.json())
          .then(data => {
            if (data.status === 'success') {
              // แสดงข้อมูลในฟอร์ม เช่น
              document.getElementById('name').value = data.data.full_name;
              document.getElementById('idcard').value = data.data.id;
              document.getElementById('phonenumber').value = data.data.phone_number;
              // กำหนดข้อมูลอื่น ๆ
            } else {
              alert(data.message); // แจ้งเตือนถ้าข้อมูลผิดพลาด
            }
          })
          .catch(error => console.error('เกิดข้อผิดพลาด:', error));
      }
    }

  
  </script>


  <!-- fitter เรียงชื่อ  -->
  <script>
    // ฟังก์ชันสำหรับกรองชื่อ
    function filterNames() {
      const input = document.getElementById('nameSearch').value.toLowerCase();
      const rows = document.querySelectorAll('#patient-info-body tr');

      rows.forEach(row => {
        const name = row.querySelector('td').innerText.toLowerCase();
        if (name.includes(input)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // ฟังก์ชันสำหรับเรียงชื่อ
    function sortNames() {
      const tbody = document.getElementById('patient-info-body');
      const rows = Array.from(tbody.querySelectorAll('tr'));

      rows.sort((a, b) => {
        const nameA = a.querySelector('td').innerText;
        const nameB = b.querySelector('td').innerText;
        return nameA.localeCompare(nameB, 'th');
      });

      rows.forEach(row => tbody.appendChild(row));
    }

  </script>

  <script>
    function filterData() {
      const searchName = document.getElementById('searchPatientInput').value.toLowerCase();
      const phone = document.getElementById('phoneFilter').value;
      const idCard = document.getElementById('idCardFilter').value.trim();
      const relativePhone = document.getElementById('relativePhoneFilter').value;
      const treatmentStatus = document.getElementById('treatmentStatusFilter').value;

      const rows = document.querySelectorAll('#patient-info-body tr');

      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const phoneValue = row.cells[3].textContent.trim();
        const idCardValue = row.cells[2].textContent.trim();
        const relativePhoneValue = row.cells[4].textContent.trim();
        const treatmentStatusValue = row.cells[5].textContent.trim();

        console.log('Comparing idCard:', idCard, 'with idCardValue:', idCardValue); // Debug line

        let isVisible = true;

        if (searchName && !name.includes(searchName)) isVisible = false;
        if (phone && !phoneValue.includes(phone)) isVisible = false;
        if (idCard && !idCardValue.includes(idCard)) isVisible = false;
        if (relativePhone && !relativePhoneValue.includes(relativePhone)) isVisible = false;
        if (treatmentStatus && treatmentStatusValue !== treatmentStatus) isVisible = false;

        row.style.display = isVisible ? '' : 'none';
      });
    }
    document.addEventListener('DOMContentLoaded', loadUserData);
  </script>

<<<<<<< HEAD

=======
<script>
  // เรียกฟังก์ชัน checkAuth() เพื่อตรวจสอบ token
  checkAuth();

  // Load sidebar
  fetch('sidebar.html')
      // ใช้ fetch เพื่อดึงข้อมูล sidebar.html
      .then(response => response.text())
      // แปลงข้อมูลที่ได้รับเป็นข้อความ
      .then(data => {
          document.getElementById('sidebar-container').innerHTML = data;
          // นำข้อมูลที่ดึงมาแสดงใน sidebar-container
          loadSidebarScript();
          // เรียกฟังก์ชัน loadSidebarScript() เพื่อทำงานเพิ่มเติมกับ sidebar
      });

  // Load topbar and set the page title
  fetch('topbar.html')
      // ใช้ fetch เพื่อดึงข้อมูล topbar.html
      .then(response => response.text())
      // แปลงข้อมูลที่ได้รับเป็นข้อความ
      .then(data => {
          document.getElementById('topbar-container').innerHTML = data;
          // นำข้อมูลที่ดึงมาแสดงใน topbar-container
          document.getElementById('page-title').textContent = 'หน้าหลัก';
          // กำหนดชื่อเรื่องของหน้าเป็น 'หน้าหลัก'

          // Re-run user.js script after loading topbar
          const script = document.createElement('script');
          // สร้างแท็ก script ใหม่
          script.src = '../method/user.js';
          // กำหนดแหล่งที่มาของ script เป็น user.js
          document.body.appendChild(script);
          // เพิ่มแท็ก script ลงใน body ของเอกสารเพื่อทำการโหลดสคริปต์
      });
</script>
>>>>>>> 69a79a22d5b320bcd7829186ac66271859454842
</body>

</html>