<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Information</title>
  <link rel="stylesheet" href="../../css/patient-info.css">
  <link rel="stylesheet" href="../../css/filltermenu.css">
  <link rel="stylesheet" href="../../styles.css">
  <link rel="stylesheet" href="../../css/sidebar.css">
  <link rel="stylesheet" href="../../css/topbar.css">
  <link rel="stylesheet" href="../../css/logo.css">
  <script src="../method/logout.js"></script>
  <!-- Import icon -->
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>

<body style="background-color:#edeff1;">
  <!-- Sidebar will be loaded here -->
  <div id="sidebar-container"></div>

  <!-- Topbar will be loaded here -->
  <div id="topbar-container"></div>

  <div class="patientinfo-container">
    <div class="filter-container">
      <div class="filter-item">
        <h5>ค้นหารายชื่อ</h5>
        <input type="text" placeholder="ค้นหาที่นี่..." class="search-input" id="searchPatientInput">
        <i class='bx bx-search search-icon'></i>
      </div>
      <div class="filter-item">
        <h5>วันที่นัดหมาย</h5>
        <input type="date" class="date-filter" id="appointmentDateFilter">
      </div>
      <div class="filter-item">
        <h5>ครั้งที่รักษา</h5>
        <select class="dropdown-filter" id="treatmentCountFilter">
          <option value="ทั้งหมด">ทั้งหมด</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <!-- Add other options as needed -->
        </select>
      </div>
      <div class="filter-item">
        <h5>สถานะการติดตาม</h5>
        <select class="dropdown-filter" id="followUpStatusFilter">
          <option value="ทั้งหมด">ทั้งหมด</option>
          <option value="ยังไม่ได้ติดตาม">ยังไม่ได้ติดตาม</option>
          <option value="กำลังติดตาม">กำลังติดตาม</option>
          <option value="ติดตามแล้ว">ติดตามแล้ว</option>
          <option value="ติดตามล้มเหลว">ติดตามล้มเหลว</option>
        </select>
      </div>
      <div class="filter-item">
        <h5>สถานะการรักษา</h5>
        <select class="dropdown-filter" id="treatmentStatusFilter">
          <option value="ทั้งหมด">ทั้งหมด</option>
          <option value="ยังไม่ได้รักษา">ยังไม่ได้รักษา</option>
          <option value="นัดติดตามต่อเนื่อง">นัดติดตามต่อเนื่อง</option>
          <option value="รักษาเสร็จสิ้น">รักษาเสร็จสิ้น</option>
        </select>
      </div>
    </div>

    <table class="patienttable">
      <thead>
        <tr>
          <th>ชื่อ - นามสกุล</th>
          <th>วันเกิด</th>
          <th>เลขบัตรประชาชน</th>
          <th>เบอร์โทรศัพท์</th>
          <th>เบอร์โทรศัพท์ญาติ</th>
          <th>สถานะการรักษา</th>
          <th></th>
        </tr>
      </thead>

      <tbody id="patient-info-body">
        <!-- ข้อมูลผู้ป่วยจะแสดงตรงนี้ -->
      </tbody>
    </table>
  </div>

  <script>
    // Load sidebar
    fetch('sidebar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('sidebar-container').innerHTML = data;
        loadSidebarScript(); // Initialize sidebar toggle after loading
      });

    // Load topbar and set the page title
    fetch('topbar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('topbar-container').innerHTML = data;
        document.getElementById('page-title').textContent = 'จัดการข้อมูลผู้ป่วย'; // Set page title for the history page
      });

    function loadSidebarScript() {
      let sidebar = document.querySelector(".sidebar");
      let closeBtn = document.querySelector("#btn");

      closeBtn.addEventListener("click", () => {
        sidebar.classList.toggle("open");
        menuBtnChange();
      });
      function menuBtnChange() {
        if (sidebar.classList.contains("open")) {
          closeBtn.classList.replace("bx-menu", "bx-menu-alt-right");
        } else {
          closeBtn.classList.replace("bx-menu-alt-right", "bx-menu");
        }
      }
    }
    document.getElementById('add-button').addEventListener('click', function () {
      window.location.href = 'editaddinfo.html';
    });
  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      // เรียกข้อมูลจาก API เมื่อหน้าเว็บโหลดเสร็จ
      $.getJSON('http://localhost/chiracarehospital/backend/sql/patient_information/getAll_patient_information.php', function (response) {
        if (response.status === 'success') {
          var patients = response.data;
          var rows = '';

          // วนลูปข้อมูลผู้ป่วยเพื่อแสดงในตาราง
          patients.forEach(function (patient) {
            rows += '<tr>';
            rows += '<td><img src="../../assets/images/cat.jpg" alt="avatar"> ' + patient.full_name + '</td>';
            rows += '<td>' + formatDate(patient.birth_date) + '</td>';
            rows += '<td>' + patient.id_card + '</td>';
            rows += '<td>' + patient.phone_number + '</td>';
            rows += '<td>' + patient.emergency_phone + '</td>';
            rows += '<td><span class="status-label ' + getStatusColor(patient.current_status) + '">' + patient.current_status + '</span></td>';


            rows += '<td>';
            rows += '<button class="action-btn" title="แก้ไขข้อมูล" onclick="editPatient(\'' + patient.id + '\')"><i class="bx bxs-edit"></i></button>';
            rows += '<button class="action-btn" title="ลบข้อมูล" onclick="deletePatient(\'' + patient.id + '\')"><i class="bx bx-trash"></i></button>';
            rows += '</td>';
            rows += '</tr>';
          });

          // แทรกข้อมูลในตาราง
          $('#patient-info-body').html(rows);
        } else {
          alert(response.message);
        }
      });

      // ฟังก์ชันสำหรับฟอร์แมตวันเกิด
      function formatDate(dateStr) {
        var date = new Date(dateStr);
        var day = String(date.getDate()).padStart(2, '0');
        var month = String(date.getMonth() + 1).padStart(2, '0'); // เดือนเริ่มจาก 0
        var year = date.getFullYear();
        return day + '-' + month + '-' + year;
      }


      function getStatusColor(status) {
        if (status === 'ปกติ') {
          return 'green'; // สถานะสีเขียวสำหรับปกติ
        } else if (status === 'เสียชีวิต') {
          return 'red'; // สถานะสีแดงสำหรับเสียชีวิต
        } else if (status === 'ไม่เป็นผู้ป่วยแล้ว') {
          return 'blue'; // สีน้ำเงินสำหรับไม่เป็นผู้ป่วยแล้ว
        } else {
          return ''; // ค่าเริ่มต้น ถ้าไม่มีสถานะที่ตรงกัน
        }
      }

    });

    // ฟังก์ชันแก้ไขข้อมูลผู้ป่วย
    function editPatient(patientId) {
      alert('แก้ไขข้อมูลผู้ป่วย ID: ' + patientId);
      // ใส่ logic การแก้ไขที่นี่
    }

    // ฟังก์ชันลบข้อมูลผู้ป่วย
    function deletePatient(patientId) {
      if (confirm('คุณต้องการลบผู้ป่วย ID: ' + patientId + ' ใช่หรือไม่?')) {
        // ใส่ logic การลบที่นี่
        alert('ลบข้อมูลผู้ป่วยเรียบร้อย');
      }
    }

  </script>
</body>

</html>